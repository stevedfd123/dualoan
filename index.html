<!DOCTYPE html>
<html lang="EN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#1565C0" />
  <title>Loan Application</title>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html, body {
      width:100%; height:100%;
      overflow:hidden;
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background:#f5f5f5;
    }
    body { position:fixed; width:100vw; height:100vh; overflow:hidden; }

    .app-container{
      width:100vw; height:100vh;
      overflow-y:auto; overflow-x:hidden;
      -webkit-overflow-scrolling:touch;
      padding-bottom:80px;
      background:#fff;
    }

    .screen{
      display:none;
      min-height:calc(100vh - 80px);
      padding:20px;
      background:white;
      position:relative;
    }
    .screen.active{ display:block; }

    .back-button{
      position:absolute; top:20px; left:20px;
      width:40px; height:40px; border-radius:50%;
      background:#fff; border:2px solid #e0e0e0;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; font-size:20px; z-index:100;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      transition:all 0.2s;
    }
    .back-button:active{ transform:scale(0.92); background:#f5f5f5; }

    .bottom-nav{
      position:fixed; bottom:0; left:0; right:0;
      background:white; border-top:2px solid #e0e0e0;
      display:none; grid-template-columns:1fr 1fr 1fr;
      padding:10px 0; z-index:1000;
      box-shadow:0 -2px 10px rgba(0,0,0,0.1);
    }
    .bottom-nav.active{ display:grid; }

    .nav-btn{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:10px; gap:5px;
      border:none; background:transparent;
      color:#999; cursor:pointer; width:100%;
      transition:all 0.2s;
    }
    .nav-btn.active-tab{ color:#1565C0; }
    .nav-btn:active{ background:#f0f0f0; }
    .nav-btn:disabled{ opacity:0.4; cursor:not-allowed; }
    .nav-btn:disabled:active{ background:transparent; }
    .nav-icon{ font-size:24px; }
    .nav-label{ font-size:12px; font-weight:600; }

    /* install */
    .install-screen{
      background:linear-gradient(135deg,#1565C0 0%,#0D47A1 100%);
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      color:white; text-align:center; padding:40px; min-height:100vh;
    }
    .install-icon{
      width:120px; height:120px; background:white; border-radius:25px;
      display:flex; align-items:center; justify-content:center;
      margin-bottom:30px;
      box-shadow:0 10px 30px rgba(0,0,0,0.3);
      animation:pulse 2s ease-in-out infinite;
    }
    .install-icon svg{ width:70px; height:70px; }
    @keyframes pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }
    .install-title{ font-size:28px; font-weight:800; margin-bottom:10px; }
    .install-subtitle{ font-size:16px; opacity:0.9; margin-bottom:40px; }
    .progress-container{
      width:100%; max-width:300px; background:rgba(255,255,255,0.2);
      border-radius:20px; height:8px; overflow:hidden; margin-bottom:20px;
    }
    .progress-bar{
      height:100%; background:white; border-radius:20px; width:0%;
      animation:progress 4s ease-in-out forwards;
    }
    @keyframes progress{ 0%{width:0%} 100%{width:100%} }
    .install-status{ font-size:14px; opacity:0.8; margin-bottom:20px; }
    .install-button{
      display:none; padding:14px 40px; background:white; color:#1565C0;
      border:none; border-radius:25px; font-size:16px; font-weight:700;
      cursor:pointer; box-shadow:0 4px 15px rgba(0,0,0,0.2);
      transition:all 0.2s;
    }
    .install-button.show{ display:inline-block; }
    .install-button:active{ transform:scale(0.95); }

    /* common */
    h1{ font-size:28px; margin-bottom:18px; text-align:center; font-weight:800; }
    .input-group{ margin-bottom:20px; }
    label{ display:block; margin-bottom:8px; font-weight:700; font-size:14px; color:#333; }
    input{
      width:100%; padding:16px; border:2px solid #ddd; border-radius:12px;
      font-size:16px; transition:border-color 0.2s;
    }
    input:focus{ outline:none; border-color:#1565C0; }
    button{
      width:100%; padding:16px; border:none; border-radius:12px;
      font-size:16px; font-weight:800; cursor:pointer; transition:all 0.2s;
    }
    button:active{ transform:scale(0.98); }
    button:disabled{ opacity:0.5; cursor:not-allowed; }

    .btn-primary{
      background:#4CAF50; color:white;
      box-shadow:0 4px 12px rgba(76,175,80,0.3);
    }
    .btn-blue{
      background:#2196F3; color:white;
      box-shadow:0 4px 12px rgba(33,150,243,0.3);
    }
    .btn-white{
      background:white; color:#1565C0;
      border:2px solid white;
      font-size:14px; padding:10px 20px; width:auto;
    }
    .btn-small{ padding:12px 16px; font-size:14px; }

    .error-message{
      background:#ffebee; color:#c62828;
      padding:12px; border-radius:12px; margin-bottom:16px; font-size:14px;
    }
    .success-message{
      background:#e8f5e9; color:#2e7d32;
      padding:12px; border-radius:12px; margin-bottom:16px; font-size:14px;
    }
    .otp-hint{
      background:linear-gradient(135deg,#e8f5e9 0%,#c8e6c9 100%);
      padding:20px; border-radius:12px; margin-bottom:16px;
      text-align:center; font-weight:900; color:#2e7d32; font-size:24px;
      box-shadow:0 4px 12px rgba(46,125,50,0.2);
    }

    .content-with-back{ padding-top:40px; }

    /* Home */
    .loan-header-box{
      background:linear-gradient(135deg,#1565C0 0%,#1976D2 100%);
      padding:24px; border-radius:16px; margin-bottom:20px;
      display:flex; justify-content:space-between; align-items:center;
      color:white;
      box-shadow:0 4px 20px rgba(21,101,192,0.3);
    }
    .loan-header-left h2{ font-size:14px; font-weight:500; margin-bottom:8px; color:rgba(255,255,255,0.9); }
    .loan-header-left .amount{ font-size:32px; font-weight:900; }

    .notice{
      background:#fff3cd; padding:12px; border-radius:12px; margin-bottom:20px;
      display:flex; align-items:center; gap:10px; font-size:13px;
    }
    .notice .dot{ width:10px; height:10px; background:red; border-radius:50%; flex-shrink:0; }

    .feature-box{
      padding:16px; border:2px solid #f0f0f0; border-radius:12px; margin-bottom:12px;
      display:flex; align-items:center; gap:15px; background:white;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    .feature-icon{ font-size:32px; flex-shrink:0; }
    .feature-content strong{ display:block; margin-bottom:4px; font-size:15px; }
    .feature-content div{ font-size:13px; color:#666; }
    .feature-box.green{ border-left:4px solid #4CAF50; }
    .feature-box.blue{ border-left:4px solid #2196F3; }
    .feature-box.orange{ border-left:4px solid #FF9800; }
    .feature-box.purple{ border-left:4px solid #9C27B0; }

    /* My Account (unbold) */
    .summary-card{
      background:linear-gradient(135deg,#0d47a1 0%,#1e66c6 100%);
      border-radius:18px;
      padding:18px 18px;
      color:#fff;
      box-shadow:0 10px 28px rgba(13,71,161,0.25);
      position:relative;
      overflow:hidden;
      margin-bottom:16px;
      min-height:120px;
    }
    .summary-card::before{
      content:"";
      position:absolute;
      right:-80px; top:-80px;
      width:220px; height:220px;
      background:rgba(255,255,255,0.10);
      border-radius:50%;
    }
    .summary-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:14px;
      position:relative;
      z-index:2;
    }
    .summary-left .label{
      font-size:14px; opacity:0.9; margin-bottom:10px;
      font-weight:400;
    }
    .summary-left .total{
      font-size:44px;
      font-weight:400;
      letter-spacing:0.3px;
      line-height:1;
    }
    .summary-left .total small{
      font-size:22px;
      font-weight:400;
      opacity:0.95;
      margin-right:6px;
      vertical-align:top;
    }
    .loan-history-btn{
      width:auto;
      padding:12px 18px;
      border-radius:14px;
      background:rgba(255,255,255,0.14);
      border:1px solid rgba(255,255,255,0.25);
      color:#fff;
      font-weight:700;
      box-shadow:none;
    }
    .loan-list{ display:flex; flex-direction:column; gap:14px; }
    .loan-card2{
      background:#fff;
      border-radius:18px;
      padding:16px 16px 14px;
      border:1px solid #eee;
      box-shadow:0 10px 22px rgba(0,0,0,0.06);
    }
    .loan-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .brand-logo{
      width:44px; height:44px; border-radius:12px;
      background:#e3f2fd;
      display:flex; align-items:center; justify-content:center;
      font-size:18px;
      font-weight:700;
      color:#1565C0;
      flex-shrink:0;
    }
    .brand-name{
      font-size:18px;
      font-weight:700;
      color:#111;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .repay-pill{
      width:auto;
      padding:10px 18px;
      border-radius:999px;
      background:#fde9e6;
      color:#1e4e9d;
      font-weight:700;
      box-shadow:none;
    }
    .rowline{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      padding:10px 0;
    }
    .rowline + .rowline{ border-top:1px solid #f0f0f0; }
    .k{ font-size:14px; color:#111; opacity:0.85; font-weight:400; }
    .v{ font-size:16px; font-weight:400; color:#111; text-align:right; }

    /* Pending Repayment (Image 1) */
    .panel-title{
      display:flex; align-items:center; gap:10px;
      font-size:20px; font-weight:700;
      color:#ff9800;
      margin-bottom:14px;
    }
    .panel-title .dot{
      width:24px; height:24px; border-radius:50%;
      background:#ffe0b2;
      display:flex; align-items:center; justify-content:center;
      color:#ff9800;
      border:1px solid #ffc107;
      font-size:14px;
      flex-shrink:0;
    }
    .summary-box{
      background:#f7f7f7;
      border-radius:14px;
      padding:18px;
      box-shadow:0 8px 20px rgba(0,0,0,0.06);
      margin-bottom:18px;
    }
    .sum-row{
      display:flex;
      justify-content:space-between;
      padding:18px 0;
      border-bottom:1px solid #ececec;
      gap:20px;
    }
    .sum-row:last-child{ border-bottom:none; }
    .sum-k{ color:#666; font-size:16px; }
    .sum-v{ color:#111; font-size:16px; text-align:right; font-weight:500; }
    .sum-v.red{ color:#ff3b30; font-weight:500; }
    .full-repay{
      width:100%;
      background:#2196F3;
      color:#fff;
      border-radius:12px;
      padding:18px;
      font-size:18px;
      font-weight:800;
      box-shadow:0 10px 24px rgba(33,150,243,0.25);
    }

    /* Payment */
    .timer{
      background:linear-gradient(135deg,#ff5252 0%,#f44336 100%);
      color:white; padding:16px; border-radius:12px; text-align:center;
      font-size:18px; margin-bottom:20px; font-weight:800;
      box-shadow:0 4px 12px rgba(244,67,54,0.3);
    }
    .payment-info-row{
      display:flex; align-items:center; gap:10px;
      margin-bottom:16px; padding:14px;
      background:#f9f9f9; border-radius:12px;
    }
    .payment-info-row label{ font-weight:800; min-width:80px; margin-bottom:0; font-size:14px; }
    .payment-info-row input{ flex:1; padding:10px; margin:0; border:none; background:transparent; font-size:14px; }
    .payment-info-row button{ padding:10px 16px; font-size:13px; width:auto; }

    .notice-box{
      background:#e3f2fd; padding:16px; border-radius:12px; margin-top:20px;
    }
    .notice-box h3{ margin-bottom:12px; font-size:15px; font-weight:900; }
    .notice-box ol{ margin-left:20px; }
    .notice-box li{ margin-bottom:8px; font-size:13px; line-height:1.5; }
  </style>
</head>

<body>
  <div class="app-container">

    <!-- Screen 0: Installing -->
    <div class="screen install-screen active" id="screen-install">
      <div class="install-icon">
        <svg viewBox="0 0 24 24" fill="#1565C0">
          <path d="M9 7h6v2H9V7zm0 4h6v2H9v-2z"/>
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
          <path d="M12 16l-4-4h8l-4 4z"/>
        </svg>
      </div>
      <div class="install-title">Installing Loan App</div>
      <div class="install-subtitle">Please wait while we set up your app...</div>
      <div class="progress-container"><div class="progress-bar"></div></div>
      <div class="install-status" id="install-status">Installing... 0%</div>
      <button class="install-button" id="install-button" onclick="goToLogin()">Go to Login Page</button>
    </div>

    <!-- Screen 1: Registration/OTP -->
    <div class="screen" id="screen-registration">
      <h1>üí∞ Loan App</h1>

      <div id="phone-section">
        <div class="input-group">
          <label>Phone Number</label>
          <input type="tel" id="phone" placeholder="Enter mobile number" value="+91 ">
        </div>
        <button class="btn-primary" onclick="sendOTP()">Send OTP</button>
      </div>

      <div id="otp-section" style="display:none; margin-top:20px;">
        <div class="success-message">‚úÖ OTP sent successfully!</div>
        <div class="otp-hint">üì± <span id="otp-display">----</span></div>
        <div class="input-group">
          <label>Enter OTP</label>
          <input type="text" id="otp" placeholder="Enter 4-digit OTP" maxlength="4">
        </div>
        <button class="btn-primary" onclick="verifyOTP()">Verify OTP</button>
      </div>

      <div id="error-message" class="error-message" style="display:none;"></div>
    </div>

    <!-- Screen 2: Home -->
    <div class="screen" id="screen-home">
      <div class="back-button" onclick="goBackFromHome()">‚Üê</div>

      <div class="content-with-back">
        <div class="loan-header-box">
          <div class="loan-header-left">
            <h2>Loan amount up to</h2>
            <div class="amount">INR ‚Çπ50,000</div>
          </div>
          <button class="btn-white" disabled>Apply Now</button>
        </div>

        <div class="notice">
          <span class="dot"></span>
          <span>Unsuccessful loan application will not incur any fees</span>
        </div>

        <div class="feature-box green">
          <div class="feature-icon">üíö</div>
          <div class="feature-content">
            <strong>Loan Amount</strong>
            <div>INR 2,600 to INR 50,000</div>
          </div>
        </div>

        <div class="feature-box blue">
          <div class="feature-icon">üìÖ</div>
          <div class="feature-content">
            <strong>Tenure</strong>
            <div>7 days - 30 days</div>
          </div>
        </div>

        <div class="feature-box orange">
          <div class="feature-icon">üßÆ</div>
          <div class="feature-content">
            <strong>Low Interest</strong>
            <div>Low as 0%</div>
          </div>
        </div>

        <div class="feature-box purple">
          <div class="feature-icon">‚ö°</div>
          <div class="feature-content">
            <strong>24 x 7 Access</strong>
            <div>to loans</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Screen 3: My Account -->
    <div class="screen" id="screen-pending">
      <div class="back-button" onclick="goBackFromPending()">‚Üê</div>

      <div class="content-with-back">
        <h1>My Account</h1>

        <div class="summary-card">
          <div class="summary-row">
            <div class="summary-left">
              <div class="label">Total amount Due</div>
              <div class="total"><small>‚Çπ</small><span id="total-due">0</span></div>
            </div>
            <button class="loan-history-btn" type="button" onclick="alert('Loan History coming soon')">Loan History</button>
          </div>
        </div>

        <div class="loan-list" id="loan-list"></div>
      </div>
    </div>

    <!-- Screen 4: Pending Repayment Details -->
    <div class="screen" id="screen-summary">
      <div class="back-button" onclick="showScreen('screen-pending')">‚Üê</div>

      <div class="content-with-back">
        <div class="panel-title">
          <div class="dot">üèõÔ∏è</div>
          <div>Pending Repayment</div>
        </div>

        <div class="summary-box">
          <div class="sum-row">
            <div class="sum-k">Total Repayment Amount</div>
            <div class="sum-v red">‚Çπ<span id="sum-total">0</span></div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Due Date</div>
            <div class="sum-v" id="sum-due">-</div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Loan Amount</div>
            <div class="sum-v">‚Çπ<span id="sum-loan">0</span></div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Late Fee</div>
            <div class="sum-v red">‚Çπ<span id="sum-late">0</span></div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Tenure</div>
            <div class="sum-v" id="sum-tenure">-</div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Application Date</div>
            <div class="sum-v" id="sum-appdate">-</div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Name</div>
            <div class="sum-v" id="sum-name">-</div>
          </div>
          <div class="sum-row">
            <div class="sum-k">Overdue Days</div>
            <div class="sum-v red"><span id="sum-overdue">0</span> days</div>
          </div>
        </div>

        <button class="full-repay" onclick="navigateToTab('payment')">Repay</button>
      </div>
    </div>

    <!-- Screen 5: Payment (NO IFSC) -->
    <div class="screen" id="screen-payment">
      <div class="back-button" onclick="showScreen('screen-summary')">‚Üê</div>

      <div class="content-with-back">
        <h1>Payment</h1>

        <div class="timer">Order closes in <span id="countdown">5:00</span></div>

        <div class="payment-info-row">
          <label>Amount</label>
          <input type="text" id="amount" value="0" readonly />
          <button class="btn-blue btn-small" onclick="copyText('amount')">Copy</button>
        </div>

        <div class="payment-info-row">
          <label>VPA/UPI</label>
          <input type="text" id="upi" value="merchant@upi" readonly />
          <button class="btn-blue btn-small" onclick="copyText('upi')">Copy</button>
        </div>

        <p style="margin:20px 0 12px 0; font-weight:900; font-size:14px;">Enter UTR after payment</p>
        <div class="input-group">
          <label>UTR Number (12 digits only)</label>
          <input type="text" id="utr" placeholder="Enter 12-digit UTR Number" maxlength="12" inputmode="numeric" oninput="validateUTR(this)" />
        </div>
        <div id="utr-error" class="error-message" style="display:none;"></div>

        <button class="btn-primary" onclick="submitUTR()">Submit UTR</button>

        <div class="notice-box">
          <h3>‚ö†Ô∏è Important Notice</h3>
          <ol>
            <li>One UPI can only transfer money once</li>
            <li>Don't change the payment amount otherwise the order cannot be closed</li>
            <li>UTR number must be exactly 12 digits</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Success -->
    <div class="screen" id="screen-success">
      <div class="back-button" onclick="navigateToTab('home')">‚Üê</div>

      <div class="loading content-with-back">
        <div style="font-size:80px; margin-bottom:20px;">‚úÖ</div>
        <h2>Payment Submitted!</h2>
        <p style="margin-top:20px; color:#666;">Your payment is being processed.</p>
        <button class="btn-primary" onclick="navigateToTab('home')" style="margin-top:40px;">Back to Home</button>
      </div>
    </div>

  </div>

  <!-- Bottom Nav -->
  <div class="bottom-nav" id="bottom-nav">
    <button class="nav-btn" id="nav-home" onclick="navigateToTab('home')" disabled>
      <div class="nav-icon">üè†</div>
      <div class="nav-label">Home</div>
    </button>
    <button class="nav-btn" id="nav-pending" onclick="navigateToTab('pending')" disabled>
      <div class="nav-icon">üë§</div>
      <div class="nav-label">My Account</div>
    </button>
    <button class="nav-btn active-tab" id="nav-payment" onclick="navigateToTab('repay')">
      <div class="nav-icon">üí≥</div>
      <div class="nav-label">Repay</div>
    </button>
  </div>

  <script>
    let countdownInterval;
    let generatedOTP = "";
    let selectedIndex = 0;

    // ‚úÖ Loans (Hi Rupee updated with YOUR details)
    const LOANS = [
      {
        provider:"Hi Rupee",
        logoText:"H",
        repayment:41160,
        orderNo:"20140203499",
        dueDate:"2025-11-26",
        loanAmount:29400,
        lateFee:11760,
        tenure:"7 days",
        applicationDate:"2025-12-03",
        name:"Lohitha MS",
        overdueDays:36
      },
      {
        provider:"Candy Bay",
        logoText:"C",
        repayment:45220,
        orderNo:"20140203499",
        dueDate:"2025-11-26",
        // keep same unless you give different values:
        loanAmount:32300,
        lateFee:12920,
        tenure:"-20 days",
        applicationDate:"2025-12-16",
        name:"Lohitha MS",
        overdueDays:36
      }
    ];

    function formatINR(n){ return Number(n || 0).toLocaleString("en-IN"); }

    window.addEventListener("load", () => simulateInstallation());

    function simulateInstallation(){
      const statusEl = document.getElementById("install-status");
      const buttonEl = document.getElementById("install-button");
      let progress = 0;

      const interval = setInterval(() => {
        progress += 2.5;
        statusEl.textContent = `Installing... ${Math.min(100, Math.floor(progress))}%`;
      }, 100);

      setTimeout(() => {
        clearInterval(interval);
        statusEl.textContent = "Installation Complete!";
        buttonEl.classList.add("show");

        // ‚úÖ IMPORTANT: NO auto redirect anymore.
        // User must click the button to go to login.
      }, 4000);
    }

    function goToLogin(){
      const installScreen = document.getElementById("screen-install");
      installScreen.style.display = "none";
      installScreen.classList.remove("active");

      const registrationScreen = document.getElementById("screen-registration");
      registrationScreen.style.display = "block";
      registrationScreen.classList.add("active");
    }

    function sendOTP(){
      const phoneInput = document.getElementById("phone").value.trim();
      const errorDiv = document.getElementById("error-message");
      errorDiv.style.display = "none";

      const phoneDigits = phoneInput.replace(/\D/g, "");
      if (phoneDigits.length < 10){
        errorDiv.textContent = "‚ùå Please enter a valid 10-digit mobile number";
        errorDiv.style.display = "block";
        return;
      }

      generatedOTP = Math.floor(1000 + Math.random() * 9000).toString();
      document.getElementById("otp-section").style.display = "block";
      document.getElementById("otp-display").textContent = generatedOTP;
      document.getElementById("phone-section").style.display = "none";
    }

    function verifyOTP(){
      const otp = document.getElementById("otp").value.trim();
      const errorDiv = document.getElementById("error-message");

      if (otp === generatedOTP){
        errorDiv.style.display = "none";

        const registrationScreen = document.getElementById("screen-registration");
        registrationScreen.style.display = "none";
        registrationScreen.classList.remove("active");

        document.getElementById("bottom-nav").classList.add("active");
        renderMyAccount();
        showScreen("screen-home");
      } else {
        errorDiv.textContent = "‚ùå Invalid OTP. Please try again.";
        errorDiv.style.display = "block";
      }
    }

    function showScreen(screenId){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(screenId).classList.add("active");
      window.scrollTo(0,0);
      if (screenId === "screen-payment") startCountdown();
    }

    function renderMyAccount(){
      const total = LOANS.reduce((sum, l) => sum + Number(l.repayment || 0), 0);
      document.getElementById("total-due").textContent = formatINR(total);

      const list = document.getElementById("loan-list");
      list.innerHTML = LOANS.map((l, idx) => `
        <div class="loan-card2">
          <div class="loan-top">
            <div class="brand">
              <div class="brand-logo">${l.logoText}</div>
              <div class="brand-name">${l.provider}</div>
            </div>
            <button class="repay-pill" onclick="openPendingRepayment(${idx})">Repay</button>
          </div>

          <div class="rowline" style="border-top:none; padding-top:0;">
            <div class="k">Repayment Amount</div>
            <div class="v">‚Çπ${formatINR(l.repayment)}</div>
          </div>

          <div class="rowline">
            <div class="k">Order Number</div>
            <div class="v">${l.orderNo}</div>
          </div>

          <div class="rowline">
            <div class="k">Due Date</div>
            <div class="v">${l.dueDate}</div>
          </div>
        </div>
      `).join("");

      setPaymentAmountFromLoan(0);
    }

    function openPendingRepayment(idx){
      selectedIndex = idx;
      const l = LOANS[selectedIndex];

      document.getElementById("sum-total").textContent = formatINR(l.repayment);
      document.getElementById("sum-due").textContent = l.dueDate;
      document.getElementById("sum-loan").textContent = formatINR(l.loanAmount);
      document.getElementById("sum-late").textContent = formatINR(l.lateFee);
      document.getElementById("sum-tenure").textContent = l.tenure;
      document.getElementById("sum-appdate").textContent = l.applicationDate;
      document.getElementById("sum-name").textContent = l.name;
      document.getElementById("sum-overdue").textContent = l.overdueDays;

      setPaymentAmountFromLoan(idx);
      showScreen("screen-summary");
    }

    function setPaymentAmountFromLoan(idx){
      const l = LOANS[idx];
      document.getElementById("amount").value = l.repayment;
    }

    function goBackFromHome(){ return; }
    function goBackFromPending(){ navigateToTab("home"); }

    function navigateToTab(tab){
      document.querySelectorAll(".nav-btn").forEach(btn => btn.classList.remove("active-tab"));

      if (tab === "home"){
        document.getElementById("nav-home").classList.add("active-tab");
        showScreen("screen-home");
      } else if (tab === "pending"){
        document.getElementById("nav-pending").classList.add("active-tab");
        renderMyAccount();
        showScreen("screen-pending");
      } else if (tab === "repay"){
        document.getElementById("nav-payment").classList.add("active-tab");
        renderMyAccount();
        showScreen("screen-pending");
      } else if (tab === "payment"){
        document.getElementById("nav-payment").classList.add("active-tab");
        showScreen("screen-payment");
      }
    }

    function copyText(elementId){
      const el = document.getElementById(elementId);
      el.select();
      navigator.clipboard.writeText(el.value).then(() => alert("Copied: " + el.value));
    }

    function validateUTR(input){
      input.value = input.value.replace(/[^0-9]/g, "");
      const errorDiv = document.getElementById("utr-error");
      if (input.value.length > 0 && input.value.length !== 12){
        errorDiv.textContent = "‚ö†Ô∏è UTR must be exactly 12 digits";
        errorDiv.style.display = "block";
      } else {
        errorDiv.style.display = "none";
      }
    }

    function startCountdown(){
      let timeLeft = 300;
      if (countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById("countdown").textContent = `${minutes}:${seconds.toString().padStart(2,"0")}`;
        if (timeLeft <= 0){
          clearInterval(countdownInterval);
          alert("Time expired!");
        }
        timeLeft--;
      }, 1000);
    }

    function submitUTR(){
      const utr = document.getElementById("utr").value;
      const errorDiv = document.getElementById("utr-error");

      if (utr.length !== 12 || !/^\d{12}$/.test(utr)){
        errorDiv.textContent = "‚ùå UTR must be exactly 12 digits";
        errorDiv.style.display = "block";
        return;
      }

      errorDiv.style.display = "none";
      if (countdownInterval) clearInterval(countdownInterval);
      document.getElementById("bottom-nav").classList.remove("active");
      showScreen("screen-success");
    }
  </script>
</body>
</html>
